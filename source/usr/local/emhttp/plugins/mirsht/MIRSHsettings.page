Menu="MIRSHops:1"
Title="MirrorShuttle Settings"
Tag="sliders"
Markdown="false"
---
<?
/* Copyright Derek Macias (parts of code from NUT package)
 * Copyright macester (parts of code from NUT package)
 * Copyright gfjardim (parts of code from NUT package)
 * Copyright SimonF (parts of code from NUT package)
 * Copyright Dan Landon (parts of code from Web GUI)
 * Copyright Bergware International (parts of code from Web GUI)
 * Copyright Lime Technology (any and all other parts of Unraid)
 *
 * Copyright desertwitch (as author and maintainer of this file)
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License 2
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 */
require_once '/usr/local/emhttp/plugins/mirsht/include/mirsh_config.php';
require_once '/usr/local/emhttp/plugins/mirsht/include/mirsh_helpers.php';
?>

<form markdown="0" id="mirsht-settings" name="mirsht_settings" method="POST" action="/update.php" target="progressFrame">
    <input type="hidden" id="mirsh-file" name="#file" value="mirsht/mirsht.cfg">
    <input type="hidden" id="mirsh-cmd" name="#command" value="/usr/local/emhttp/plugins/mirsht/scripts/write_config">

    <dl>
        <dt>Backend:</dt>
        <dd>
            <strong><?= isset($mirsh_backend) && $mirsh_backend ? $mirsh_backend : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt><strong>Scheduled Moving:</strong></dt>
        <dd>
            <select class="mirshrun" id="CRON" name="CRON" size="1">
                <?=mk_option($mirsh_cron, "disable", "Never");?>
                <?=mk_option($mirsh_cron, "hourly", "Hourly");?>
                <?=mk_option($mirsh_cron, "daily", "Daily");?>
                <?=mk_option($mirsh_cron, "weekly", "Weekly");?>
                <?=mk_option($mirsh_cron, "monthly", "Monthly");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    <p>This setting controls how often scheduled moving will be performed.</p>
    </blockquote>

    <div id="CRONDOWSETTING">
        <dl>
            <dt>Scheduled Moving - Day of Week:</dt>
            <dd>
                <select class="mirshrun" id="CRONDOW" name="CRONDOW" size="1">
                    <?=mk_option($mirsh_crondow, "0", "Sunday");?>
                    <?=mk_option($mirsh_crondow, "1", "Monday");?>
                    <?=mk_option($mirsh_crondow, "2", "Tuesday");?>
                    <?=mk_option($mirsh_crondow, "3", "Wednesday");?>
                    <?=mk_option($mirsh_crondow, "4", "Thursday");?>
                    <?=mk_option($mirsh_crondow, "5", "Friday");?>
                    <?=mk_option($mirsh_crondow, "6", "Saturday");?>
                </select>
            </dd>
        </dl>
    </div>

    <div id="CRONDOMSETTING">
        <dl>
            <dt>Scheduled Moving - Day of Month:</dt>
            <dd>
                <select class="mirshrun" id="CRONDOM" name="CRONDOM" size="1">
                    <?=mirsh_dom_options($mirsh_crondom);?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>Beware that not all months of the year have more than 28 days.</p>
        </blockquote>
    </div>

    <div id="CRONHOURSETTING">
        <dl>
            <dt>Scheduled Moving - Hour:</dt>
            <dd>
                <select class="mirshrun" id="CRONHOUR" name="CRONHOUR" size="1">
                    <?=mirsh_hour_options($mirsh_cronhour);?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>It is recommended to pick a time when ideally no other I/O (data transfer) operations are also happening.</p>
        </blockquote>
    </div>

    <div id="CRONSETTINGS">
        <dl>
            <dt>Scheduled Moving - Started Notifications:</dt>
            <dd>
                <select class="mirshrun" id="STARTNOTIFY" name="STARTNOTIFY" size="1">
                    <?=mk_option($mirsh_startnotify, "disable", "No");?>
                    <?=mk_option($mirsh_startnotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when the scheduled moving starts.</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>

        <dl>
            <dt>Scheduled Moving - Finished Notifications:</dt>
            <dd>
                <select class="mirshrun" id="FINISHNOTIFY" name="FINISHNOTIFY" size="1">
                    <?=mk_option($mirsh_finishnotify, "disable", "No");?>
                    <?=mk_option($mirsh_finishnotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when the scheduled moving finishes (regardless of success or failure).</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>

        <dl>
            <dt>Scheduled Moving - Failure Notifications:</dt>
            <dd>
                <select class="mirshrun" id="ERRORNOTIFY" name="ERRORNOTIFY" size="1">
                    <?=mk_option($mirsh_errornotify, "disable", "No");?>
                    <?=mk_option($mirsh_errornotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when the scheduled moving encounters any failures (errors).</p>
        <p>This setting can be useful when <strong><em>Finished Notifications</em></strong> are disabled and you want to be notified only of scheduled moving failures (errors).</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>
    </div>

    <dl>
        <dt></dt>
        <dd>
            <input type="submit" id="btnApply" name="#apply" value="Apply">
            <input type="button" value="Done" onclick="done()">
            <input id="DEFAULT" type="submit" class="mirshtip" name="#default" value="Default" title="Reverts the configuration to default values.">
        </dd>
    </dl>
</form>

<script>
function mirshCronSettings() {
    if ($("#CRON").val() === "hourly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "daily") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "weekly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").show();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "monthly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").show();
    } else {
        $("#CRONSETTINGS").hide();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    }
}
$(function() {
    showStatus('mirrorshuttle');
    mirshCronSettings();

    if ("<?=$mirsh_running;?>" == 1){
        $('.mirshrun').prop('disabled', true);
    } else {
        $('.mirshrun').prop('disabled', false);
    }

    $("#CRON").change(mirshCronSettings);

    $('.mirshtip').tooltipster({
        maxWidth: 300
    });

    if ( typeof caPluginUpdateCheck === "function" ) {
        caPluginUpdateCheck("mirsht.plg",{name:"MirrorShuttle"});
    }
});
</script>
